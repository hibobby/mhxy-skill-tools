# 发布与更新指南

 本指南说明如何在本地打包 Tauri 桌面应用并向已安装用户分发更新，同时说明更新对已有数据的影响。

## 前置条件

- 已安装 Node.js（建议 LTS 版本）
- 已安装 Rust MSVC 工具链（见 `安装Rust.md`）
- 已安装 Tauri CLI（可选，但推荐）：

   ```bash
   npm install -g @tauri-apps/cli
   ```

- 图标文件已按 `生成图标说明.md` 准备好（打包时必须存在）

## 版本号与元数据

- 在打包前，请更新 `src-tauri/tauri.conf.json` 中的 `"version"`，以区分新旧安装包并让安装器识别为新版本。
- 如需改产品名称或标识，可调整 `"productName"` 和 `"identifier"`，保持唯一。

## 打包步骤（Windows 示例）

 1) 安装依赖（如已安装可跳过）：

    ```bash
    npm install
    ```

 2) 前端构建：

    ```bash
    npm run build
    ```

 3) 构建桌面安装包：

    ```bash
    npm run tauri build
    ```

 4) 构建产物位置：
    - Windows 安装包（推荐分发）：`src-tauri/target/release/bundle/msi/`
    - 可执行文件（自测用）：`src-tauri/target/release/`
    - 如果同时需要其他平台的包（dmg/appimage 等），Tauri 会对应生成在 `bundle/` 子目录中。

## 向用户分发与更新

- 当前项目 **未接入 Tauri 自动更新**。发布新版本时，直接将新的 `.msi` 安装包分发给用户，覆盖安装即可完成更新。
- 重新安装不会删除用户数据；若要彻底清理，需要手动删除数据文件（见下文）。

## 数据存储与更新影响

- Release 模式下的数据文件路径：
  - Windows: `C:\Users\<用户名>\AppData\Roaming\mhxy\mhxy.db`
  - macOS: `~/Library/Application Support/mhxy/mhxy.db`
  - Linux: `~/.local/share/mhxy/mhxy.db`
- 安装新版本不会覆盖上述路径的数据文件，账号/技能等记录会保留。
- 建议在发布前提示用户自行备份 `mhxy.db`，或在重装前手动复制该文件。

## 本地自测流程

- 打包后，可直接运行 `src-tauri/target/release/梦幻西游账号管理.exe` 验证启动与数据读取。
- 如需验证安装流程，先卸载旧版（不删除数据目录），再运行新的 `.msi` 安装包。

## 常见问题

- **缺少图标**：请按 `生成图标说明.md` 生成 `src-tauri/icons/` 下的图标，否则打包会失败。
- **Rust/VC 环境缺失**：参考 `安装Rust.md` 安装并确认 `rustc --version` 可用。
- **版本号未更新**：同一版本号重复安装可能被系统视为相同安装包，更新前请先提高 `"version"`。

## 相关文档

- `快速开始.txt`：运行与打包的简明步骤
- `生成图标说明.md`：图标生成要求
- `安装Rust.md`：Rust 安装与排查
